<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #fff6fb;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h2 {
      text-align: center;
      color: #cc3377;
      margin-bottom: 30px;
    }

    .section {
      background: #ffeef5;
      border: 2px solid #ffb3cc;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 4px 8px rgba(255, 182, 193, 0.3);
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      color: #cc0052;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 2px solid #ff99bb;
      border-radius: 8px;
      font-size: 16px;
    }

    button {
      margin-top: 15px;
      padding: 10px 20px;
      background: #ff66a3;
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #e60073;
    }

    .student-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #fff;
      border: 1px solid #ffccdd;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
    }

    .student-item input[type="checkbox"] {
      margin-right: 10px;
    }

    @media (max-width: 600px) {
      input, button {
        font-size: 15px;
      }
    }
  </style>
</head>
<body>

  <h2>üå∏ Admin Panel</h2>

  <!-- Add Student -->
  <div class="section">
    <h3>üë©‚Äçüéì Add Student</h3>
    <label>Name</label>
    <input type="text" id="studentName" placeholder="Enter name" />

    <label>Image Filename (e.g. dip.png)</label>
    <input type="text" id="studentImage" placeholder="Only the filename" />

    <label>Total Points</label>
    <input type="number" id="studentPoints" placeholder="Start points" />

    <button onclick="addStudent()">Add Student</button>
  </div>

  <!-- Add Task -->
  <div class="section">
    <h3>üìã Add Task</h3>
    <label>Task Name</label>
    <input type="text" id="taskName" placeholder="Enter task" />

    <label>Points</label>
    <input type="number" id="taskPoints" placeholder="e.g. 100" />

    <button onclick="addTask()">Add Task</button>
  </div>

  <!-- Add Gift -->
  <div class="section">
    <h3>üéÅ Add Gift</h3>
    <label>Gift Name</label>
    <input type="text" id="giftName" placeholder="Enter gift name" />

    <label>Cost (Points)</label>
    <input type="number" id="giftCost" placeholder="e.g. 200" />

    <label>Image Filename (e.g. pen.png)</label>
    <input type="text" id="giftImage" placeholder="Only the filename" />

    <button onclick="addGift()">Add Gift</button>
  </div>

  <!-- Update Points -->
  <div class="section">
    <h3>‚ú® Update Points</h3>
    <div id="studentsList">Loading students...</div>

    <label>Points to Add/Subtract</label>
    <input type="number" id="pointsToAdd" placeholder="e.g. 100 or -50" />

    <button onclick="updatePoints()">Save Points</button>
  </div>

  <!-- Firebase + Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, addDoc, getDocs, updateDoc, doc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { firebaseConfig } from "./firebaseConfig.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function addStudent() {
      const name = document.getElementById("studentName").value.trim();
      const image = document.getElementById("studentImage").value.trim();
      const totalPoints = parseInt(document.getElementById("studentPoints").value);

      if (!name || !image || isNaN(totalPoints)) {
        alert("Please fill all student fields.");
        return;
      }

      await addDoc(collection(db, "students"), {
        name: name,
        image: image,
        totalPoints: totalPoints,
        pointsSpent: 0
      });

      alert("Student added!");
      document.getElementById("studentName").value = "";
      document.getElementById("studentImage").value = "";
      document.getElementById("studentPoints").value = "";
      loadStudents();
    }

    async function addTask() {
      const name = document.getElementById("taskName").value.trim();
      const points = parseInt(document.getElementById("taskPoints").value);

      if (!name || isNaN(points)) {
        alert("Please fill all task fields.");
        return;
      }

      await addDoc(collection(db, "tasks"), {
        name: name,
        points: points
      });

      alert("Task added!");
      document.getElementById("taskName").value = "";
      document.getElementById("taskPoints").value = "";
    }

    async function addGift() {
      const name = document.getElementById("giftName").value.trim();
      const cost = parseInt(document.getElementById("giftCost").value);
      const image = document.getElementById("giftImage").value.trim();

      if (!name || isNaN(cost) || !image) {
        alert("Please fill all gift fields.");
        return;
      }

      await addDoc(collection(db, "gifts"), {
        name: name,
        cost: cost,
        image: image
      });

      alert("Gift added!");
      document.getElementById("giftName").value = "";
      document.getElementById("giftCost").value = "";
      document.getElementById("giftImage").value = "";
    }

    let allStudents = [];

    async function loadStudents() {
      const snapshot = await getDocs(collection(db, "students"));
      const container = document.getElementById("studentsList");
      container.innerHTML = "";
      allStudents = [];

      snapshot.forEach(docSnap => {
        const student = docSnap.data();
        allStudents.push({ id: docSnap.id, ...student });

        const div = document.createElement("div");
        div.className = "student-item";
        div.innerHTML = `
          <label>
            <input type="checkbox" value="${docSnap.id}" />
            ${student.name} (${student.totalPoints} pts)
          </label>
        `;
        container.appendChild(div);
      });
    }

    async function updatePoints() {
      const checkboxes = document.querySelectorAll("#studentsList input[type='checkbox']:checked");
      const pointDelta = parseInt(document.getElementById("pointsToAdd").value);
      if (checkboxes.length === 0 || isNaN(pointDelta)) {
        alert("Select students and enter valid points.");
        return;
      }

      for (let checkbox of checkboxes) {
        const studentId = checkbox.value;
        const student = allStudents.find(s => s.id === studentId);
        const newPoints = student.totalPoints + pointDelta;

        await updateDoc(doc(db, "students", studentId), {
          totalPoints: newPoints
        });
      }

      alert("Points updated!");
      document.getElementById("pointsToAdd").value = "";
      loadStudents();
    }

    loadStudents();
  </script>
</body>
</html>
