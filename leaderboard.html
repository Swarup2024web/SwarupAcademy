<!DOCTYPE html>
<html>
<head>
  <title>Leaderboard</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>

  <!-- ‚úÖ HEADER -->
  <div class="header">
    <!-- Row 1: Login -->
    <div class="header-row">
      <input id="nameInput" placeholder="Enter your name & press Enter" onkeypress="handleLogin(event)" />
    </div>

    <!-- Row 2: Points and Level -->
    <div class="header-row">
      <div class="level-box" id="statusDisplay">Not logged in</div>
    </div>

    <!-- Row 3: Tabs -->
    <div class="nav-tabs">
      <i class="fas fa-trophy" title="Leaderboard"></i>
      <i class="fas fa-tasks" title="Tasks" onclick="window.location.href='tasks.html'"></i>
      <i class="fas fa-gift" title="Gifts" onclick="window.location.href='gifts.html'"></i>
    </div>
  </div>

  <!-- ‚úÖ Leaderboard -->
  <h2>üèÜ Leaderboard</h2>
  <table id="leaderboardTable">
    <thead>
      <tr>
        <th>Image</th>
        <th>Name</th>
        <th>Total Points</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- Filled dynamically -->
    </tbody>
  </table>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { firebaseConfig } from "./firebaseConfig.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let students = [];

    const imageBase = "https://raw.githubusercontent.com/Swarup2024web/assets/main/";

    async function loadLeaderboard() {
      const snap = await getDocs(collection(db, "students"));
      students = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));

      students.sort((a, b) => b.totalPoints - a.totalPoints);

      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";
      students.forEach(stu => {
        const tr = document.createElement("tr");

        const img = document.createElement("img");
        img.src = imageBase + stu.image;
        img.className = "avatar";

        const tdImg = document.createElement("td");
        tdImg.appendChild(img);

        const tdName = document.createElement("td");
        tdName.textContent = stu.name;

        const tdPoints = document.createElement("td");
        tdPoints.textContent = stu.totalPoints;

        tr.appendChild(tdImg);
        tr.appendChild(tdName);
        tr.appendChild(tdPoints);
        tbody.appendChild(tr);
      });
    }

    function getLevel(totalPoints) {
      if (totalPoints >= 800) return 3;
      if (totalPoints >= 500) return 2;
      if (totalPoints >= 100) return 1;
      return 0;
    }

    function handleLogin(e) {
      if (e.key === "Enter") {
        const name = e.target.value.trim().toLowerCase();
        const student = students.find(s => s.name.toLowerCase() === name);
        const statusBox = document.getElementById("statusDisplay");

        if (student) {
          e.target.placeholder = student.name;
          e.target.value = "";
          const level = getLevel(student.totalPoints);
          statusBox.textContent = `${student.totalPoints} pts | Level ${level}`;
        } else {
          statusBox.textContent = "‚ùå Not Found";
        }
      }
    }

    loadLeaderboard();
  </script>
</body>
</html>
